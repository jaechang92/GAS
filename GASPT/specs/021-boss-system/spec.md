# 보스 시스템

**기능 번호**: 021
**브랜치**: `021-boss-system`
**작성일**: 2025-12-14
**상태**: 명세 완료
**관련 기능**: 016-procedural-level-generation, 019-form-content-design

---

## 1. 개요

### 1.1 기능 설명
던전 진행 중 특정 조건에서 등장하는 보스 전투 시스템입니다. 보스는 일반 적과 달리 페이즈별 패턴을 가지며, 전용 UI와 연출로 긴장감 있는 전투 경험을 제공합니다. 보스 처치 시 특별한 보상을 획득할 수 있습니다.

### 1.2 설계 원칙
1. **차별화된 전투 경험**: 일반 전투와 구분되는 보스전만의 긴장감
2. **패턴 학습**: 플레이어가 보스 패턴을 학습하고 대응하는 재미
3. **페이즈 전환**: 단계별 난이도 상승으로 점진적 도전
4. **시각적 피드백**: 전용 UI로 보스 상태 명확하게 전달
5. **의미있는 보상**: 보스 처치가 가치있다고 느끼는 보상 체계

### 1.3 범위
- **포함**: 보스 데이터 구조, 페이즈 시스템, 패턴 AI, 전용 UI, 보상 시스템
- **제외**: 개별 보스 아트 에셋, 보스 전용 BGM 제작, 컷씬

---

## 2. 보스 등장 조건

### 2.1 던전 내 보스 방

| 스테이지 | 보스 방 위치 | 보스 타입 |
|---------|------------|----------|
| 스테이지 1 | 5번째 방 | 미니보스 |
| 스테이지 2 | 5번째 방 | 미니보스 |
| 스테이지 3 | 5번째 방 | 중간보스 |
| 스테이지 4 | 5번째 방 | 중간보스 |
| 스테이지 5 | 5번째 방 | 최종보스 |

### 2.2 보스 등급

| 등급 | 특징 | 페이즈 수 | 예상 전투 시간 |
|-----|------|:--------:|:-------------:|
| 미니보스 | 강화된 일반 적 | 1~2 | 30초~1분 |
| 중간보스 | 고유 패턴 보유 | 2~3 | 1~2분 |
| 최종보스 | 복잡한 패턴 조합 | 3~4 | 2~4분 |

---

## 3. 보스 데이터 구조

### 3.1 BossData 필드

| 필드 | 타입 | 설명 |
|-----|------|------|
| bossId | string | 고유 식별자 (B001, B002 등) |
| bossName | string | 보스 이름 (UI 표시용) |
| description | string | 보스 설명 (도감용) |
| bossGrade | BossGrade | 미니보스/중간보스/최종보스 |
| elementType | ElementType | 속성 (Fire/Ice/Thunder/Dark/None) |

### 3.2 스탯 필드

| 필드 | 타입 | 설명 |
|-----|------|------|
| maxHealth | int | 최대 체력 |
| baseAttack | int | 기본 공격력 |
| defense | int | 방어력 |
| moveSpeed | float | 이동 속도 |

### 3.3 페이즈 관련 필드

| 필드 | 타입 | 설명 |
|-----|------|------|
| phases | BossPhase[] | 페이즈 목록 |
| phaseThresholds | float[] | 페이즈 전환 체력 비율 (예: [0.7, 0.4]) |

### 3.4 보상 필드

| 필드 | 타입 | 설명 |
|-----|------|------|
| goldReward | int | 처치 시 골드 |
| expReward | int | 처치 시 경험치 |
| guaranteedDrops | LootItem[] | 확정 드롭 |
| randomDrops | LootTable | 확률 드롭 테이블 |

---

## 4. 페이즈 시스템

### 4.1 페이즈 전환 조건

```
Phase 1 (100% ~ 70%)
    ↓ 체력 70% 이하
Phase 2 (70% ~ 40%)
    ↓ 체력 40% 이하
Phase 3 (40% ~ 0%)
```

### 4.2 페이즈 전환 연출

| 단계 | 내용 | 시간 |
|-----|------|:----:|
| 1 | 보스 무적 상태 전환 | 0초 |
| 2 | 페이즈 전환 애니메이션 | 0~1초 |
| 3 | 화면 효과 (플래시/쉐이크) | 0.5초 |
| 4 | 새 페이즈 UI 업데이트 | 즉시 |
| 5 | 무적 해제, 새 패턴 시작 | 1.5초 |

### 4.3 페이즈별 변화

| 변화 요소 | Phase 1 | Phase 2 | Phase 3 |
|----------|:-------:|:-------:|:-------:|
| 공격력 | 100% | 120% | 150% |
| 공격 속도 | 100% | 110% | 125% |
| 이동 속도 | 100% | 105% | 115% |
| 패턴 복잡도 | 기본 | 추가 패턴 | 강화 패턴 |

---

## 5. 패턴 AI 시스템

### 5.1 패턴 타입

| 패턴 타입 | 설명 | 예시 |
|----------|------|------|
| Melee | 근접 공격 | 내려찍기, 돌진 |
| Ranged | 원거리 공격 | 투사체 발사, 빔 |
| Area | 범위 공격 | 장판, 충격파 |
| Summon | 소환 | 졸개 소환 |
| Buff | 자기 강화 | 분노, 방어 강화 |
| Special | 특수 기술 | 페이즈 전용 필살기 |

### 5.2 패턴 실행 흐름

```
1. 패턴 선택 (가중치 기반 랜덤)
    ↓
2. 패턴 준비 (텔레그래프 표시)
    ↓
3. 패턴 실행 (데미지/효과 적용)
    ↓
4. 패턴 종료 (쿨다운 시작)
    ↓
5. 대기 시간
    ↓
1. 다음 패턴 선택
```

### 5.3 텔레그래프 시스템

플레이어에게 공격 예고를 시각적으로 전달

| 텔레그래프 타입 | 사용 상황 | 표시 시간 |
|---------------|----------|:--------:|
| 원형 범위 | 범위 공격 | 0.8~1.5초 |
| 직선 범위 | 돌진, 빔 | 0.5~1초 |
| 전체 화면 | 필살기 | 2~3초 |
| 마커 (대상) | 추적 공격 | 1초 |

---

## 6. 보스 전용 UI

### 6.1 UI 구성 요소

```
┌─────────────────────────────────────────┐
│  [보스 이름]                             │
│  ████████████████░░░░░  72%             │
│  [Phase 2/3]  ◆ ◆ ◇                     │
└─────────────────────────────────────────┘
```

| 요소 | 설명 | 위치 |
|-----|------|------|
| 보스 이름 | 보스 식별 | 상단 중앙 |
| 체력바 | 현재/최대 체력 비율 | 이름 아래 |
| 체력 퍼센트 | 수치로 표시 | 체력바 우측 |
| 페이즈 표시 | 현재 페이즈 / 총 페이즈 | 체력바 아래 |
| 페이즈 아이콘 | 남은 페이즈 시각화 | 페이즈 표시 우측 |

### 6.2 체력바 색상

| 페이즈 | 체력바 색상 | 의미 |
|-------|-----------|------|
| Phase 1 | 녹색 (#4CAF50) | 안전 |
| Phase 2 | 주황색 (#FF9800) | 주의 |
| Phase 3 | 빨간색 (#F44336) | 위험 |
| 페이즈 전환 중 | 보라색 (#9C27B0) | 무적 |

### 6.3 보스 등장 연출

| 단계 | 연출 | 시간 |
|-----|------|:----:|
| 1 | 화면 어두워짐 | 0.5초 |
| 2 | 보스 등장 위치 표시 | 0.5초 |
| 3 | 보스 등장 + 이름 표시 | 1초 |
| 4 | 플레이어 조작 잠금 | 0~2초 |
| 5 | 전투 시작 | 2초 후 |

---

## 7. 보스 목록 (예시)

### 7.1 B001: 불꽃 골렘 (Flame Golem)

| 항목 | 값 |
|-----|-----|
| 등급 | 미니보스 |
| 속성 | Fire |
| 등장 | 스테이지 1 |
| 체력 | 500 |
| 공격력 | 15 |

**패턴**:
| 패턴 | 타입 | 데미지 | 쿨다운 |
|-----|------|:------:|:------:|
| 화염 내려찍기 | Melee | 20 | 4초 |
| 화염구 발사 | Ranged | 15 | 3초 |
| 폭발 (Phase 2) | Area | 25 | 8초 |

**보상**:
- 골드: 100
- 경험치: 50
- 폼 드롭 확률: 10%

---

### 7.2 B002: 얼음 정령 (Frost Spirit)

| 항목 | 값 |
|-----|-----|
| 등급 | 미니보스 |
| 속성 | Ice |
| 등장 | 스테이지 2 |
| 체력 | 600 |
| 공격력 | 12 |

**패턴**:
| 패턴 | 타입 | 데미지 | 쿨다운 | 효과 |
|-----|------|:------:|:------:|------|
| 얼음 창 | Ranged | 15 | 3초 | 슬로우 30% |
| 빙결 지대 | Area | 10/틱 | 6초 | 빙결 확률 10% |
| 얼음 소환수 (Phase 2) | Summon | - | 12초 | 2체 소환 |

**보상**:
- 골드: 120
- 경험치: 60
- 폼 드롭 확률: 12%

---

### 7.3 B003: 번개 드래곤 (Thunder Dragon)

| 항목 | 값 |
|-----|-----|
| 등급 | 중간보스 |
| 속성 | Thunder |
| 등장 | 스테이지 3 |
| 체력 | 1200 |
| 공격력 | 25 |

**패턴**:
| 패턴 | 타입 | 데미지 | 쿨다운 | 효과 |
|-----|------|:------:|:------:|------|
| 낙뢰 | Ranged | 30 | 4초 | 기절 0.5초 |
| 연쇄 번개 | Area | 20×3 | 8초 | 3회 연쇄 |
| 돌진 (Phase 2) | Melee | 40 | 10초 | 넉백 |
| 분노 (Phase 3) | Buff | - | 20초 | 공속 +50% |
| 번개 폭풍 (Phase 3) | Special | 50 | 15초 | 전체 범위 |

**보상**:
- 골드: 300
- 경험치: 150
- 폼 드롭 확률: 20%
- Unique 폼 드롭 확률: 5%

---

### 7.4 B004: 어둠의 군주 (Dark Lord)

| 항목 | 값 |
|-----|-----|
| 등급 | 최종보스 |
| 속성 | Dark |
| 등장 | 스테이지 5 |
| 체력 | 2500 |
| 공격력 | 40 |

**페이즈 구성**:
| 페이즈 | 체력 범위 | 특징 |
|:------:|----------|------|
| 1 | 100%~70% | 기본 패턴 |
| 2 | 70%~40% | 분신 소환 |
| 3 | 40%~15% | 암흑 폭풍 |
| 4 | 15%~0% | 광폭화 |

**패턴**:
| 패턴 | 타입 | 데미지 | 쿨다운 | 페이즈 |
|-----|------|:------:|:------:|:------:|
| 암흑 베기 | Melee | 35 | 3초 | 전체 |
| 암흑구 | Ranged | 30 | 4초 | 전체 |
| 생명력 흡수 | Area | 40 | 10초 | 1+ |
| 분신 소환 | Summon | - | 20초 | 2+ |
| 암흑 폭풍 | Special | 60 | 25초 | 3+ |
| 멸망의 일격 | Special | 100 | 30초 | 4 |

**보상**:
- 골드: 1000
- 경험치: 500
- 확정 드롭: Legendary 폼 1개
- 암흑 마법사 폼 확정 드롭

---

## 8. 보상 시스템

### 8.1 기본 보상

| 보스 등급 | 골드 | 경험치 | 폼 드롭 확률 |
|----------|:----:|:------:|:-----------:|
| 미니보스 | 80~150 | 40~80 | 10~15% |
| 중간보스 | 200~400 | 100~200 | 15~25% |
| 최종보스 | 500~1000 | 250~500 | 100% (확정) |

### 8.2 추가 보상 조건

| 조건 | 보너스 |
|-----|--------|
| 피해 0 (노히트) | 골드 +50% |
| 빠른 처치 (제한시간 50% 이내) | 경험치 +30% |
| 첫 클리어 | 특별 보상 (1회) |

### 8.3 첫 클리어 보상

| 보스 | 첫 클리어 보상 |
|-----|---------------|
| B001 불꽃 골렘 | 화염 마법사 폼 (Rare) |
| B002 얼음 정령 | 얼음 마법사 폼 (Rare) |
| B003 번개 드래곤 | 번개 마법사 폼 (Unique) |
| B004 어둠의 군주 | 암흑 마법사 폼 (Legendary) |

---

## 9. 밸런스 가이드라인

### 9.1 보스 체력 공식

```
미니보스 체력 = 기본값 × (1 + 스테이지 × 0.2)
중간보스 체력 = 기본값 × (1 + 스테이지 × 0.3)
최종보스 체력 = 기본값 × (1 + 스테이지 × 0.4)
```

### 9.2 예상 전투 시간

| 보스 등급 | 최소 | 적정 | 최대 (타임아웃) |
|----------|:----:|:----:|:--------------:|
| 미니보스 | 20초 | 45초 | 2분 |
| 중간보스 | 40초 | 90초 | 3분 |
| 최종보스 | 90초 | 180초 | 5분 |

### 9.3 난이도 조절 변수

| 변수 | 조절 범위 | 영향 |
|-----|----------|------|
| 패턴 텔레그래프 시간 | 0.5~2초 | 회피 난이도 |
| 패턴 간 대기 시간 | 1~3초 | 공격 기회 |
| 페이즈 전환 체력 비율 | ±10% | 전투 리듬 |
| 분노 모드 조건 | 체력 20~30% | 마무리 난이도 |

---

## 10. 성공 기준

### 10.1 기능 완성도

- [ ] 보스 전투 시작부터 종료까지 정상 동작
- [ ] 페이즈 전환이 체력 기준으로 정확히 작동
- [ ] 모든 패턴이 텔레그래프와 함께 실행
- [ ] 보스 UI가 실시간으로 상태 반영
- [ ] 보상이 정상적으로 지급

### 10.2 사용자 경험

- [ ] 플레이어가 패턴을 학습하고 회피 가능
- [ ] 페이즈 전환 시 긴장감 상승
- [ ] 보스 처치 시 성취감 제공
- [ ] UI를 통해 보스 상태 명확히 인지

### 10.3 성능

- [ ] 보스 전투 중 60FPS 유지
- [ ] 패턴 실행 시 프레임 드롭 없음
- [ ] UI 업데이트 지연 없음

---

## 11. 의존성

### 11.1 필수 의존성

| 시스템 | 용도 |
|--------|------|
| EnemySystem | 보스 기본 클래스 |
| DamageSystem | 데미지 처리 |
| StatusEffectSystem | 상태 효과 (빙결, 화상 등) |
| PoolManager | 투사체, 이펙트 풀링 |
| UISystem | 보스 전용 UI |

### 11.2 선택적 의존성

| 시스템 | 용도 |
|--------|------|
| AudioSystem | 보스 전투 BGM, 효과음 |
| CameraSystem | 화면 흔들림, 줌 효과 |
| SaveSystem | 첫 클리어 기록 저장 |

---

## 12. 구현 우선순위

### Phase 1: 기반 시스템 (핵심)
1. BossData ScriptableObject 정의
2. BaseBoss 기본 클래스
3. BossPhase 시스템
4. BossHealthBarUI

### Phase 2: 패턴 AI
5. 패턴 기본 구조 (BossPattern)
6. 텔레그래프 시스템
7. 패턴 선택 로직 (가중치)

### Phase 3: 보스 구현
8. B001 불꽃 골렘 (미니보스)
9. B002 얼음 정령 (미니보스)
10. B003 번개 드래곤 (중간보스)

### Phase 4: 완성
11. B004 어둠의 군주 (최종보스)
12. 보상 시스템
13. 던전-보스 연동
14. 밸런싱 및 폴리싱

---

## 13. 가정

- 기존 Enemy 시스템을 확장하여 Boss 구현
- 보스 방은 절차적 생성에서 고정 위치로 배치
- 보스 전투 중에는 방 이탈 불가
- 보스 처치 실패 시 방 재도전 가능

---

## 14. 관련 문서

- `specs/016-procedural-level-generation/spec.md` - 던전 생성 시스템
- `specs/019-form-content-design/spec.md` - 폼 컨텐츠 (보상 연동)
- `Assets/_Project/Scripts/Gameplay/Enemies/Enemy.cs` - 기존 적 시스템
- `Assets/_Project/Scripts/UI/MVP/` - UI 시스템

---

*작성: Claude Code*
*최종 수정: 2025-12-14*
