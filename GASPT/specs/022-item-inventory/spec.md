# 아이템/인벤토리 시스템

**기능 번호**: 022
**브랜치**: `022-item-inventory`
**작성일**: 2025-12-27
**상태**: 명세 작성 중
**관련 기능**: 021-boss-system, 018-meta-progression

---

## 1. 개요

### 1.1 기능 설명
던전 탐험 중 아이템을 획득하고 관리하는 시스템입니다. 플레이어는 적 처치나 보물상자에서 아이템을 드롭받아 인벤토리에 저장하고, 장비 슬롯에 장착하여 캐릭터 능력을 강화할 수 있습니다. 소비 아이템으로 즉각적인 효과를 얻을 수 있으며, 아이템 등급에 따라 다양한 스탯 보너스가 부여됩니다.

### 1.2 설계 원칙
1. **직관적인 관리**: 아이템 획득, 장착, 사용이 간편해야 함
2. **성장 동기 부여**: 더 좋은 아이템을 얻고자 하는 욕구 자극
3. **전략적 선택**: 장비 조합에 따른 빌드 다양성
4. **명확한 피드백**: 아이템 효과와 변화를 즉각 인지
5. **경제적 가치**: 아이템 판매/분해로 다른 시스템과 연동

### 1.3 범위
- **포함**: 아이템 데이터 구조, 인벤토리 관리, 장비 시스템, 소비 아이템, 드롭 시스템, UI
- **제외**: 아이템 제작(크래프팅), 아이템 강화/인챈트, 거래소, 창고 시스템

---

## 2. 아이템 분류

### 2.1 아이템 카테고리

| 카테고리 | 설명 | 예시 |
|---------|------|------|
| Equipment | 장비 아이템 (장착) | 무기, 방어구, 악세서리 |
| Consumable | 소비 아이템 (사용) | 포션, 스크롤, 음식 |
| Material | 재료 아이템 (보유) | 강화석, 제작 재료 |
| Currency | 재화 아이템 (자동 획득) | 골드, 보석 |
| Quest | 퀘스트 아이템 | 열쇠, 문서 |

### 2.2 아이템 등급 (Rarity)

| 등급 | 색상 | 드롭 확률 | 스탯 보너스 배율 |
|-----|------|:--------:|:---------------:|
| Common (일반) | 흰색 (#FFFFFF) | 60% | 1.0x |
| Uncommon (고급) | 녹색 (#4CAF50) | 25% | 1.2x |
| Rare (희귀) | 파란색 (#2196F3) | 10% | 1.5x |
| Epic (영웅) | 보라색 (#9C27B0) | 4% | 2.0x |
| Legendary (전설) | 주황색 (#FF9800) | 1% | 3.0x |

### 2.3 장비 슬롯

| 슬롯 | 장비 타입 | 주요 스탯 |
|-----|----------|----------|
| Weapon | 무기 (검, 지팡이, 단검 등) | 공격력, 공격속도 |
| Armor | 방어구 (갑옷) | 방어력, 체력 |
| Helmet | 투구 | 방어력, 마나 |
| Gloves | 장갑 | 공격속도, 치명타 |
| Boots | 신발 | 이동속도, 회피 |
| Accessory1 | 악세서리 1 (반지) | 다양함 |
| Accessory2 | 악세서리 2 (목걸이) | 다양함 |

---

## 3. 아이템 데이터 구조

### 3.1 ItemData 기본 필드

| 필드 | 타입 | 설명 |
|-----|------|------|
| itemId | string | 고유 식별자 (ITM001, ITM002 등) |
| itemName | string | 아이템 이름 (UI 표시용) |
| description | string | 아이템 설명 |
| category | ItemCategory | 카테고리 (Equipment/Consumable 등) |
| rarity | ItemRarity | 등급 |
| icon | Sprite | 아이템 아이콘 |
| stackable | bool | 중첩 가능 여부 |
| maxStack | int | 최대 중첩 수 (기본: 99) |
| sellPrice | int | 판매 가격 |

### 3.2 EquipmentData 추가 필드

| 필드 | 타입 | 설명 |
|-----|------|------|
| equipSlot | EquipSlot | 장착 슬롯 |
| requiredLevel | int | 착용 레벨 제한 |
| requiredForm | FormType | 착용 폼 제한 (None = 제한 없음) |
| baseStats | StatModifier[] | 기본 스탯 보너스 |
| setId | string | 세트 아이템 ID (없으면 null) |

### 3.3 ConsumableData 추가 필드

| 필드 | 타입 | 설명 |
|-----|------|------|
| consumeType | ConsumeType | 효과 타입 (Heal/Buff/Teleport 등) |
| effectValue | float | 효과 수치 |
| effectDuration | float | 지속 시간 (초, 0 = 즉시) |
| cooldown | float | 재사용 대기시간 |

### 3.4 StatModifier 구조

| 필드 | 타입 | 설명 |
|-----|------|------|
| statType | StatType | 스탯 종류 |
| modifierType | ModifierType | Flat(고정) / Percent(%) |
| value | float | 수치 |

---

## 4. 인벤토리 시스템

### 4.1 인벤토리 구조

```
┌─────────────────────────────────────────────────────────┐
│  인벤토리 (Inventory)                                    │
│  ┌─────────────────────────────────────────────────────┐ │
│  │  슬롯 배열 (InventorySlot[])                         │ │
│  │  [0][1][2][3][4][5][6][7]   ← 행 1                  │ │
│  │  [8][9][10][11][12][13][14][15]   ← 행 2           │ │
│  │  ...                                                │ │
│  └─────────────────────────────────────────────────────┘ │
│  총 슬롯: 40개 (기본) / 확장 가능                         │
└─────────────────────────────────────────────────────────┘
```

### 4.2 인벤토리 슬롯 구조

| 필드 | 타입 | 설명 |
|-----|------|------|
| slotIndex | int | 슬롯 인덱스 |
| item | ItemInstance | 아이템 인스턴스 (null = 빈 슬롯) |
| quantity | int | 수량 |
| isLocked | bool | 잠금 상태 |

### 4.3 아이템 인스턴스

| 필드 | 타입 | 설명 |
|-----|------|------|
| instanceId | string | 고유 인스턴스 ID |
| itemData | ItemData | 기본 아이템 데이터 참조 |
| additionalStats | StatModifier[] | 랜덤 추가 스탯 |
| durability | int | 내구도 (선택적) |
| isEquipped | bool | 장착 중 여부 |

### 4.4 인벤토리 용량

| 상태 | 슬롯 수 |
|-----|:------:|
| 기본 | 40 |
| 확장 1단계 | 60 |
| 확장 2단계 | 80 |
| 최대 | 100 |

---

## 5. 장비 시스템

### 5.1 장비 장착 조건

| 조건 | 설명 |
|-----|------|
| 레벨 제한 | 캐릭터 레벨 ≥ 아이템 요구 레벨 |
| 폼 제한 | 특정 폼 전용 장비 (마법사 전용 지팡이 등) |
| 슬롯 일치 | 아이템 슬롯 타입 = 장착하려는 슬롯 |

### 5.2 장비 장착 흐름

```
1. 장착 요청
    ↓
2. 조건 검증 (레벨, 폼, 슬롯)
    ↓ 실패 시: 오류 메시지 표시
3. 기존 장비 확인
    ↓ 기존 장비 있음: 인벤토리로 이동
4. 새 장비 장착
    ↓
5. 스탯 재계산
    ↓
6. UI 업데이트
```

### 5.3 스탯 적용 순서

```
1. 기본 스탯 (Base Stats)
    ↓
2. 장비 고정 스탯 (Flat Modifiers)
    ↓
3. 장비 퍼센트 스탯 (Percent Modifiers)
    ↓
4. 버프/디버프 적용
    ↓
5. 최종 스탯 (Final Stats)
```

### 5.4 세트 아이템 효과

| 세트 착용 수 | 보너스 |
|:----------:|--------|
| 2개 | 세트 효과 1 활성화 |
| 4개 | 세트 효과 2 활성화 |
| 6개 (풀세트) | 세트 효과 3 활성화 + 외형 변경 |

---

## 6. 소비 아이템

### 6.1 소비 아이템 타입

| 타입 | 설명 | 예시 |
|-----|------|------|
| Heal | 즉시 회복 | 체력 포션, 마나 포션 |
| HealOverTime | 지속 회복 | 재생 포션 |
| Buff | 일시적 스탯 강화 | 공격력 물약, 이속 물약 |
| Cleanse | 상태 이상 제거 | 해독제 |
| Teleport | 이동 | 귀환 스크롤 |
| Revive | 부활 | 부활석 |

### 6.2 기본 포션 목록

| 아이템 | 효과 | 쿨다운 | 등급 |
|-------|------|:------:|------|
| 소형 체력 포션 | HP +50 | 3초 | Common |
| 중형 체력 포션 | HP +100 | 3초 | Uncommon |
| 대형 체력 포션 | HP +200 | 3초 | Rare |
| 소형 마나 포션 | MP +30 | 3초 | Common |
| 공격력 물약 | ATK +20% (30초) | 60초 | Uncommon |
| 이동속도 물약 | SPD +30% (15초) | 30초 | Uncommon |

### 6.3 퀵슬롯

```
┌─────────────────────────────────────────┐
│  [1] [2] [3] [4] [5]                    │
│   ↑ 단축키로 빠른 사용                   │
└─────────────────────────────────────────┘
```

| 슬롯 | 단축키 | 용도 |
|:---:|:-----:|------|
| 1 | 1 | 체력 포션 (자동 배정) |
| 2 | 2 | 마나 포션 (자동 배정) |
| 3 | 3 | 사용자 지정 |
| 4 | 4 | 사용자 지정 |
| 5 | 5 | 사용자 지정 |

---

## 7. 드롭 시스템

### 7.1 드롭 소스

| 소스 | 드롭 방식 | 특징 |
|-----|----------|------|
| 일반 적 | 확률 드롭 | 낮은 등급 위주 |
| 엘리트 적 | 확정 + 확률 | 중급 등급 |
| 보스 | 확정 다수 | 높은 등급 보장 |
| 보물상자 | 확정 | 상자 등급에 따름 |
| 숨겨진 방 | 확정 희귀 | Epic 이상 보장 |

### 7.2 드롭 테이블 구조

| 필드 | 타입 | 설명 |
|-----|------|------|
| minDrops | int | 최소 드롭 수 |
| maxDrops | int | 최대 드롭 수 |
| entries | DropEntry[] | 드롭 항목 목록 |

### 7.3 DropEntry 구조

| 필드 | 타입 | 설명 |
|-----|------|------|
| itemId | string | 아이템 ID |
| weight | float | 가중치 (확률) |
| minQuantity | int | 최소 수량 |
| maxQuantity | int | 최대 수량 |

### 7.4 드롭 확률 계산

```
개별 확률 = 해당 아이템 가중치 / 전체 가중치 합계
```

### 7.5 드롭 아이템 표시

| 단계 | 내용 | 시간 |
|-----|------|:----:|
| 1 | 적 사망 위치에 아이템 생성 | 즉시 |
| 2 | 아이템 튀어오르는 애니메이션 | 0.3초 |
| 3 | 바닥에 착지 + 빛나는 효과 | 즉시 |
| 4 | 플레이어 접근 시 자동 획득 | 반경 1.5m |
| 5 | 획득 UI 표시 | 2초간 |

---

## 8. 아이템 스탯 보너스

### 8.1 스탯 종류

| 스탯 | 약어 | 설명 |
|-----|------|------|
| Attack | ATK | 공격력 |
| Defense | DEF | 방어력 |
| MaxHealth | HP | 최대 체력 |
| MaxMana | MP | 최대 마나 |
| AttackSpeed | ASPD | 공격 속도 |
| MoveSpeed | SPD | 이동 속도 |
| CritRate | CRIT | 치명타 확률 |
| CritDamage | CDMG | 치명타 데미지 |
| Evasion | EVA | 회피율 |
| HealthRegen | HREG | 체력 재생 |
| ManaRegen | MREG | 마나 재생 |

### 8.2 등급별 스탯 범위 (무기 기준)

| 등급 | ATK 범위 | 추가 스탯 수 |
|-----|:--------:|:----------:|
| Common | 5~10 | 0 |
| Uncommon | 10~18 | 0~1 |
| Rare | 15~25 | 1~2 |
| Epic | 22~35 | 2~3 |
| Legendary | 30~50 | 3~4 |

### 8.3 추가 스탯 생성 규칙

```
1. 추가 스탯 수 결정 (등급별 범위 내 랜덤)
    ↓
2. 스탯 종류 선택 (중복 불가)
    ↓
3. 수치 결정 (등급별 범위 내 랜덤)
    ↓
4. 아이템 인스턴스에 저장
```

---

## 9. 인벤토리 UI

### 9.1 UI 레이아웃

```
┌────────────────────────────────────────────────────────────────┐
│  [캐릭터 정보]          │        [인벤토리 탭]                  │
│  ┌──────────────────┐   │  [전체] [장비] [소비] [재료]          │
│  │                  │   │  ┌─────────────────────────────────┐ │
│  │   캐릭터 모델     │   │  │ [아이템][아이템][아이템][...]   │ │
│  │                  │   │  │ [아이템][아이템][아이템][...]   │ │
│  │   [H] [A]        │   │  │ [아이템][아이템][...]           │ │
│  │   [G] [B]        │   │  │                                 │ │
│  │   [W] [AC1][AC2] │   │  │                                 │ │
│  └──────────────────┘   │  └─────────────────────────────────┘ │
│                         │  골드: 12,345  슬롯: 32/40           │
│  [스탯 정보]            │                                      │
│  ATK: 45  DEF: 23       │  [정렬] [자동정리]                    │
│  HP: 200  SPD: 5.0      │                                      │
└────────────────────────────────────────────────────────────────┘
```

### 9.2 아이템 슬롯 표시

| 요소 | 표시 방법 |
|-----|----------|
| 아이콘 | 슬롯 중앙 |
| 등급 | 테두리 색상 |
| 수량 | 우하단 숫자 (2개 이상) |
| 장착 상태 | 좌상단 'E' 아이콘 |
| 잠금 상태 | 자물쇠 아이콘 |
| 새 아이템 | 황금빛 테두리 애니메이션 |

### 9.3 아이템 툴팁

```
┌─────────────────────────────────┐
│  [아이콘] 불꽃의 검 (Epic)       │
│  ───────────────────────────────│
│  무기 - 한손검                   │
│  요구 레벨: 15                   │
│                                 │
│  기본 스탯:                      │
│  • 공격력 +28                    │
│  • 공격속도 +5%                  │
│                                 │
│  추가 스탯:                      │
│  • 치명타 확률 +3%               │
│  • 화염 데미지 +10               │
│                                 │
│  "고대 용암에서 단조된 검"        │
│  ───────────────────────────────│
│  판매가: 150 골드                │
└─────────────────────────────────┘
```

### 9.4 아이템 컨텍스트 메뉴

| 메뉴 항목 | 적용 대상 | 설명 |
|---------|----------|------|
| 장착/장착 해제 | 장비 | 장비 슬롯에 장착/해제 |
| 사용 | 소비 아이템 | 아이템 사용 |
| 퀵슬롯 등록 | 소비 아이템 | 단축키 슬롯에 등록 |
| 잠금/잠금 해제 | 전체 | 실수로 판매/삭제 방지 |
| 분해 | 장비 | 재료로 분해 |
| 버리기 | 전체 | 아이템 삭제 |
| 비교 | 장비 | 현재 장착 아이템과 비교 |

---

## 10. 성공 기준

### 10.1 기능 완성도

- [ ] 아이템 획득 시 인벤토리에 정상 추가
- [ ] 장비 아이템 장착/해제 정상 동작
- [ ] 스탯 보너스가 캐릭터에 정확히 반영
- [ ] 소비 아이템 사용 시 효과 정상 적용
- [ ] 아이템 드롭이 등급별 확률에 따라 작동
- [ ] 인벤토리 가득 찼을 때 적절한 처리

### 10.2 사용자 경험

- [ ] 아이템 획득 시 시각/청각 피드백 제공
- [ ] 인벤토리 정리가 직관적으로 가능
- [ ] 아이템 비교로 교체 판단 용이
- [ ] 퀵슬롯으로 전투 중 빠른 아이템 사용

### 10.3 성능

- [ ] 인벤토리 열기 시 프레임 드롭 없음
- [ ] 다수 아이템 드롭 시 60FPS 유지
- [ ] 아이템 정렬 1초 이내 완료

---

## 11. 의존성

### 11.1 필수 의존성

| 시스템 | 용도 |
|--------|------|
| PlayerStats | 스탯 적용 |
| UISystem (MVP) | 인벤토리 UI |
| SaveSystem | 아이템 저장 |
| PoolManager | 드롭 아이템 풀링 |

### 11.2 선택적 의존성

| 시스템 | 용도 |
|--------|------|
| AudioSystem | 획득/장착 효과음 |
| VFXSystem | 등급별 드롭 이펙트 |
| FormSystem | 폼별 장비 제한 |

---

## 12. 구현 우선순위

### Phase 1: 데이터 구조
1. ItemCategory, ItemRarity, EquipSlot enum 정의
2. ItemData, EquipmentData, ConsumableData ScriptableObject
3. StatModifier 구조체
4. ItemInstance 클래스

### Phase 2: 인벤토리 코어
5. InventorySlot 클래스
6. InventoryManager 싱글톤
7. 아이템 추가/제거/이동 로직
8. 인벤토리 저장/로드

### Phase 3: 장비 시스템
9. EquipmentManager 클래스
10. 장비 장착/해제 로직
11. 스탯 계산 시스템 (StatCalculator)
12. PlayerStats 연동

### Phase 4: 소비 아이템 & 드롭
13. ConsumableItem 사용 로직
14. QuickSlotManager
15. DropTable, DropManager
16. 드롭 아이템 프리팹

### Phase 5: UI
17. InventoryView (MVP)
18. ItemSlotUI
19. ItemTooltip
20. EquipmentPanel

### Phase 6: 폴리싱
21. 아이템 정렬/필터링
22. 세트 아이템 효과
23. 밸런싱 및 테스트

---

## 13. 가정

- 인벤토리 데이터는 로컬에 저장되며, 서버 동기화는 고려하지 않음
- 아이템 거래/교환 기능은 범위 외
- 장비 강화/인챈트는 별도 기능으로 분리
- 초기에는 기본 아이템 20~30종으로 시작

---

## 14. 관련 문서

- `specs/021-boss-system/spec.md` - 보스 드롭 연동
- `specs/018-meta-progression/spec.md` - 영구 업그레이드 연동
- `Assets/_Project/Scripts/Stats/PlayerStats.cs` - 스탯 시스템

---

*작성: Claude Code*
*최종 수정: 2025-12-27*
