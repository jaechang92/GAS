# Feature Specification: CharacterPhysics 시스템 완성

**Feature Branch**: `001-character-physics-completion`
**Created**: 2025-10-25
**Status**: Draft
**Input**: User description: "CharacterPhysics 시스템 완성 - 벽 점프 및 슬라이딩, 낙하 플랫폼 상호작용, 스컬별 이동 특성 구현"

## User Scenarios & Testing *(mandatory)*

### User Story 1 - 벽 점프 및 슬라이딩 (Priority: P1)

플레이어가 양쪽 벽을 번갈아 점프하며 높은 곳에 도달할 수 있어야 합니다. 벽에 닿으면 천천히 슬라이딩하고, 점프 키를 누르면 반대 방향으로 튀어나갑니다.

**Why this priority**: 2D 플랫포머의 핵심 메커닉으로, 수직 공간 탐험을 가능하게 합니다. 이 기능 없이는 특정 레벨 구역에 도달할 수 없으며, 전투 시 기동성과 회피 능력을 제공합니다.

**Independent Test**: 좌우 벽이 배치된 수직 통로(높이 15 유닛)에서 플레이어가 양쪽 벽을 번갈아 점프하며 최상단까지 도달할 수 있는지 검증합니다. 벽 슬라이딩 속도가 일반 낙하 속도의 30% 이하인지 측정합니다.

**Acceptance Scenarios**:

1. **Given** 플레이어가 공중에서 벽에 닿은 상태, **When** 플레이어가 벽 방향 키를 누르고 있을 때, **Then** 플레이어는 벽을 천천히 슬라이딩하며 낙하 속도가 감소합니다
2. **Given** 플레이어가 벽 슬라이딩 중일 때, **When** 점프 키를 누를 때, **Then** 플레이어는 벽에서 떨어지며 반대 방향으로 대각선 점프를 수행합니다
3. **Given** 플레이어가 벽 슬라이딩 중일 때, **When** 반대 방향 키를 입력할 때, **Then** 벽에서 떨어지며 슬라이딩이 즉시 중단됩니다
4. **Given** 플레이어가 벽 슬라이딩 중일 때, **When** 접지 상태가 될 때, **Then** 슬라이딩 상태가 자동으로 종료됩니다
5. **Given** 플레이어가 벽 점프를 수행한 직후, **When** 반대편 벽에 닿을 때, **Then** 즉시 다시 벽 슬라이딩 상태로 전환되어 연속 벽 점프가 가능합니다

---

### User Story 2 - 낙하 플랫폼 상호작용 (Priority: P2)

플레이어가 플랫폼 위에서 아래 방향 키와 점프 키를 동시에 눌러 일방향 플랫폼을 통과할 수 있어야 합니다. 플랫폼 아래에서는 자유롭게 통과하고, 위에서만 착지할 수 있습니다.

**Why this priority**: 레벨 디자인의 유연성을 제공하며, 빠른 이동 경로와 전투 중 회피 기동을 가능하게 합니다. 수직 레벨 탐험에서 필수적인 메커닉입니다.

**Independent Test**: 3층 구조의 낙하 플랫폼 테스트 스테이지에서 플레이어가 최상단에서 아래 방향+점프 입력으로 각 층을 통과하여 바닥까지 도달할 수 있는지 검증합니다. 또한 아래에서 위로 점프하여 각 플랫폼에 정상적으로 착지할 수 있는지 확인합니다.

**Acceptance Scenarios**:

1. **Given** 플레이어가 낙하 플랫폼 위에 서 있을 때, **When** 아래 방향 키와 점프 키를 동시에 누를 때, **Then** 플레이어는 플랫폼을 통과하여 아래로 낙하합니다
2. **Given** 플레이어가 낙하 플랫폼 아래에 있을 때, **When** 위로 점프할 때, **Then** 플레이어는 플랫폼을 자유롭게 통과하여 위로 이동합니다
3. **Given** 플레이어가 낙하 플랫폼 위에서 떨어지는 중일 때, **When** 플랫폼 위에 착지할 때, **Then** 플레이어는 플랫폼 위에 정상적으로 서게 됩니다
4. **Given** 플레이어가 낙하 플랫폼을 통과하는 중일 때, **When** 통과 도중 다시 위로 점프하려 할 때, **Then** 일정 시간(0.3초) 동안은 플랫폼과 충돌하지 않아 완전히 통과할 수 있습니다
5. **Given** 플레이어가 낙하 플랫폼 통과 후 0.3초가 지났을 때, **When** 다시 위로 점프하여 플랫폼에 닿을 때, **Then** 플랫폼 위에 정상적으로 착지합니다

---

### User Story 3 - 스컬별 이동 특성 (Priority: P3)

다른 스컬(클래스)을 장착하면 이동 특성이 변화하여 각 플레이 스타일에 맞는 고유한 느낌을 제공해야 합니다. 예를 들어, 전사 스컬은 묵직하고 강력하며, 마법사 스컬은 가볍고 민첩합니다.

**Why this priority**: 게임의 핵심 차별화 요소인 아이템 기반 클래스 변신 시스템을 물리 레벨에서 구현합니다. 각 스컬마다 다른 느낌을 제공하여 재플레이 가치를 높입니다.

**Independent Test**: 3가지 스컬(기본/전사/마법사)을 각각 장착한 상태에서 동일한 장애물 코스를 통과하며, 이동 속도, 점프 높이, 공중 제어력의 차이를 체감할 수 있는지 검증합니다. 각 스컬의 특성이 명확하게 구분되는지 측정합니다.

**Acceptance Scenarios**:

1. **Given** 플레이어가 전사 스컬을 장착한 상태, **When** 이동 및 점프를 수행할 때, **Then** 기본 스컬 대비 이동 속도 -10%, 점프 높이 -15%, 공중 제어력 -20%가 적용되어 묵직한 느낌을 제공합니다
2. **Given** 플레이어가 마법사 스컬을 장착한 상태, **When** 이동 및 점프를 수행할 때, **Then** 기본 스컬 대비 이동 속도 +15%, 점프 높이 +10%, 공중 제어력 +25%가 적용되어 가볍고 민첩한 느낌을 제공합니다
3. **Given** 플레이어가 스컬을 변경할 때, **When** 새로운 스컬을 장착할 때, **Then** 이동 특성이 즉시 변경되며 플레이어가 체감할 수 있는 차이가 발생합니다
4. **Given** 플레이어가 특정 스컬을 장착한 상태, **When** 벽 점프 및 벽 슬라이딩을 수행할 때, **Then** 스컬별 이동 특성이 벽 상호작용에도 일관되게 적용됩니다
5. **Given** 플레이어가 공중에 있을 때, **When** 좌우 방향키로 이동 방향을 조정할 때, **Then** 스컬별 공중 제어력 차이가 명확하게 체감됩니다

---

### Edge Cases

- **벽 점프 연속 실행**: 플레이어가 양쪽 벽 사이에서 무한정 벽 점프를 반복할 때, 시스템이 안정적으로 동작하는가?
- **벽 슬라이딩 중 상태 전환**: 벽 슬라이딩 중 대시나 공격 등 다른 액션이 입력되면 어떻게 처리하는가?
- **낙하 플랫폼 통과 타이밍**: 플레이어가 낙하 플랫폼 통과 직후 즉시 위로 점프하려 할 때, 플랫폼과의 재충돌을 방지하는가?
- **낙하 플랫폼과 벽 점프 조합**: 벽 점프 중 낙하 플랫폼에 착지하려 할 때 정상적으로 동작하는가?
- **스컬 변경 중 상태 유지**: 공중이나 벽 슬라이딩 중 스컬을 변경하면 물리 상태가 올바르게 전환되는가?
- **극단적인 이동 특성 값**: 스컬 이동 특성이 극단적인 값(예: 이동 속도 +200%)일 때 물리 시스템이 불안정해지지 않는가?
- **벽 감지 경계 조건**: 매우 얇은 벽이나 모서리 부분에서도 벽 슬라이딩/점프가 정상적으로 작동하는가?
- **동시 입력 처리**: 벽 점프와 낙하 플랫폼 통과를 동시에 시도할 때 우선순위가 명확한가?

## Requirements *(mandatory)*

### Functional Requirements

#### 벽 점프 및 슬라이딩 시스템

- **FR-001**: 시스템은 플레이어가 공중에서 벽에 닿았을 때 벽 방향 키 입력을 감지하여 벽 슬라이딩 상태로 전환해야 합니다
- **FR-002**: 벽 슬라이딩 상태에서 플레이어의 낙하 속도는 일반 낙하 속도의 30% 이하로 감소되어야 합니다
- **FR-003**: 벽 슬라이딩 중 점프 키 입력 시, 플레이어는 벽의 반대 방향으로 대각선 점프를 수행해야 합니다
- **FR-004**: 벽 점프의 수평 속도는 일반 이동 속도의 120%, 수직 속도는 일반 점프의 85%로 설정되어야 합니다
- **FR-005**: 벽 슬라이딩 중 반대 방향 키 입력 또는 접지 시 슬라이딩 상태가 즉시 종료되어야 합니다
- **FR-006**: 시스템은 좌우 양쪽 벽을 구분하여 각각 독립적으로 벽 슬라이딩/점프를 처리해야 합니다
- **FR-007**: 벽 감지는 플레이어 캐릭터의 좌우 측면에 BoxCast를 사용하여 수행되어야 하며, 감지 거리는 0.1 유닛으로 설정되어야 합니다

#### 낙하 플랫폼 시스템

- **FR-008**: 시스템은 특정 플랫폼을 "낙하 플랫폼"으로 태그하여 일반 플랫폼과 구분해야 합니다
- **FR-009**: 플레이어가 낙하 플랫폼 위에서 아래 방향 키와 점프 키를 동시에 누르면, 플랫폼 충돌을 일시적으로 무시하고 통과해야 합니다
- **FR-010**: 낙하 플랫폼 아래에서 위로 접근하는 플레이어는 플랫폼과 충돌하지 않고 자유롭게 통과해야 합니다
- **FR-011**: 낙하 플랫폼 위에서 위로 향하는 속도로 착지하려는 플레이어는 플랫폼 위에 정상적으로 착지해야 합니다
- **FR-012**: 낙하 플랫폼 통과 후 0.3초 동안 해당 플랫폼과의 충돌을 무시하는 쿨다운 기간이 적용되어야 합니다
- **FR-013**: 시스템은 여러 낙하 플랫폼이 겹쳐 있을 때 각각 독립적으로 충돌 처리를 수행해야 합니다

#### 스컬별 이동 특성 시스템

- **FR-014**: 시스템은 각 스컬마다 고유한 이동 특성 프로필(이동 속도 배율, 점프 높이 배율, 공중 제어력 배율)을 정의할 수 있어야 합니다
- **FR-015**: 기본 스컬은 모든 배율이 100%(1.0)로 설정되어야 합니다
- **FR-016**: 전사 스컬은 이동 속도 90%, 점프 높이 85%, 공중 제어력 80%로 설정되어야 합니다
- **FR-017**: 마법사 스컬은 이동 속도 115%, 점프 높이 110%, 공중 제어력 125%로 설정되어야 합니다
- **FR-018**: 스컬 변경 시 이동 특성 변경은 즉시 적용되어야 하며, 현재 물리 상태(속도, 가속도)는 새로운 특성에 맞게 재조정되어야 합니다
- **FR-019**: 스컬별 이동 특성은 기본 이동, 점프, 벽 점프, 공중 제어 등 모든 이동 메커닉에 일관되게 적용되어야 합니다
- **FR-020**: 시스템은 ScriptableObject를 사용하여 스컬별 이동 특성 데이터를 관리해야 합니다

### Key Entities

- **WallData**: 벽의 속성을 정의합니다. 포함 정보: 벽 방향(좌/우), 벽 슬라이딩 가능 여부, 벽 표면 마찰력
- **OneWayPlatform**: 낙하 플랫폼의 속성을 정의합니다. 포함 정보: 플랫폼 타입, 통과 가능 방향, 충돌 무시 쿨다운 시간
- **SkullMovementProfile**: 스컬별 이동 특성을 정의하는 ScriptableObject입니다. 포함 정보: 이동 속도 배율, 점프 높이 배율, 공중 제어력 배율, 벽 점프 수평/수직 속도 배율
- **CharacterPhysicsState**: 캐릭터의 현재 물리 상태를 추적합니다. 포함 정보: 접지 여부, 벽 슬라이딩 여부, 벽 방향, 현재 속도, 적용 중인 스컬 프로필

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: 플레이어가 15 유닛 높이의 수직 벽 통로에서 벽 점프만을 사용하여 5초 이내에 최상단까지 도달할 수 있어야 합니다
- **SC-002**: 벽 슬라이딩 속도가 일반 낙하 속도의 30% 이하로 측정되어야 합니다
- **SC-003**: 플레이어가 3층 구조의 낙하 플랫폼 테스트 스테이지에서 아래 방향+점프 입력으로 2초 이내에 모든 플랫폼을 통과하여 바닥에 도달할 수 있어야 합니다
- **SC-004**: 낙하 플랫폼 아래에서 위로 점프하여 각 플랫폼에 착지하는 동작이 100% 성공률로 수행되어야 합니다
- **SC-005**: 전사, 마법사, 기본 스컬 간 이동 속도 차이가 플레이어가 명확하게 체감할 수 있어야 하며, 동일한 거리 이동 시 시간 차이가 최소 15% 이상이어야 합니다
- **SC-006**: 스컬 변경 후 0.1초 이내에 새로운 이동 특성이 적용되어 즉각적인 피드백을 제공해야 합니다
- **SC-007**: 벽 점프 연속 실행 시 프레임 드롭이나 물리 불안정성이 발생하지 않아야 하며, 60 FPS 이상을 유지해야 합니다
- **SC-008**: 플레이 테스터의 90% 이상이 벽 점프, 낙하 플랫폼, 스컬별 이동 차이를 각각 5분 이내에 이해하고 활용할 수 있어야 합니다

## Assumptions *(optional)*

- 플레이어는 이미 기본 이동 및 점프 메커닉에 익숙한 상태입니다
- 현재 CharacterPhysics 시스템은 BoxCollider2D 기반 충돌 감지를 사용하고 있습니다
- Layer 시스템은 이미 구축되어 있으며, Ground Layer와 Player Layer가 정의되어 있습니다
- 게임은 60 FPS를 목표로 하며, 물리 업데이트는 FixedUpdate에서 수행됩니다
- 스컬 시스템은 이미 구현되어 있으며, 스컬 변경 이벤트를 구독할 수 있습니다
- 낙하 플랫폼은 별도의 Layer 또는 Tag를 사용하여 일반 플랫폼과 구분됩니다
- 벽 점프는 연속적으로 무한정 수행 가능하며, 별도의 스태미나 제한이 없습니다
- 이동 특성 배율은 ScriptableObject로 관리되어 런타임에 변경 가능합니다

## Dependencies *(optional)*

- **기존 CharacterPhysics 시스템**: 기본 이동, 점프, 충돌 감지 로직이 구현되어 있어야 합니다
- **InputHandler 시스템**: 벽 방향 키, 아래 방향 키, 점프 키 입력을 감지할 수 있어야 합니다
- **Skull 시스템**: 스컬 변경 이벤트 및 현재 장착된 스컬 정보를 제공해야 합니다
- **Layer/Tag 시스템**: Wall Layer, OneWayPlatform Tag/Layer가 Unity 프로젝트에 정의되어 있어야 합니다
- **ScriptableObject 인프라**: 스컬별 이동 특성 데이터를 저장하고 로드할 수 있어야 합니다

## Out of Scope *(optional)*

- **더블 점프 메커닉**: 공중에서 추가 점프를 수행하는 기능은 포함되지 않습니다
- **대시 메커닉 개선**: 기존 대시 시스템의 수정이나 확장은 이번 작업 범위에 포함되지 않습니다
- **애니메이션 통합**: 벽 슬라이딩, 벽 점프 애니메이션 제작 및 적용은 별도 작업입니다
- **사운드 효과**: 벽 슬라이딩 및 벽 점프 사운드는 이번 범위에 포함되지 않습니다
- **벽 킥 특수 동작**: 벽을 밀어내는 특수 동작이나 벽 점프 강화 메커닉은 포함되지 않습니다
- **스컬별 고유 이동 어빌리티**: 각 스컬의 고유한 특수 이동 기술(예: 이중 점프, 공중 대시)은 포함되지 않으며, 기본 이동 특성 수치 조정만 포함됩니다
- **레벨 디자인**: 실제 게임 레벨에서 벽 점프 및 낙하 플랫폼을 활용하는 구조 설계는 별도 작업입니다
- **튜토리얼 시스템**: 플레이어에게 새로운 메커닉을 가르치는 튜토리얼 구현은 포함되지 않습니다
